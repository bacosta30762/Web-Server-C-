<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Server Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h1>üöÄ Web Server</h1>
                    <p class="subtitle">A simple and powerful HTTP server built with C#</p>
                </div>
                <div id="userInfo" style="text-align: right;">
                    <div id="userDisplay" style="margin-bottom: 10px; display: none;">
                        <span style="color: #667eea; font-weight: 600;">üë§ Logged in as: </span>
                        <span id="username" style="color: #333; font-weight: 600;"></span>
                    </div>
                    <button id="logoutBtn" onclick="handleLogout()" style="display: none; padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: background 0.3s;">
                        üö™ Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-info">
                    <div class="stat-label">Uptime</div>
                    <div class="stat-value" id="uptime">Loading...</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-info">
                    <div class="stat-label">Total Requests</div>
                    <div class="stat-value" id="requests">Loading...</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÅ</div>
                <div class="stat-info">
                    <div class="stat-label">Root Directory</div>
                    <div class="stat-value small" id="directory">Loading...</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üîå</div>
                <div class="stat-info">
                    <div class="stat-label">Port</div>
                    <div class="stat-value" id="port">Loading...</div>
                </div>
            </div>
        </div>

        <div class="features">
            <h2>‚ú® Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üìÇ</div>
                    <h3>Directory Browsing</h3>
                    <p>Browse files and folders directly in your browser. Visit any directory path to see its contents.</p>
                    <a href="/api/files" class="feature-link">Try it ‚Üí</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîå</div>
                    <h3>RESTful API</h3>
                    <p>Access server statistics and file information via JSON API endpoints.</p>
                    <a href="/api/stats" class="feature-link">View API ‚Üí</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìÑ</div>
                    <h3>Static File Serving</h3>
                    <p>Serve HTML, CSS, JavaScript, images, and other static files efficiently.</p>
                    <a href="/" class="feature-link">Browse Files ‚Üí</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Real-time Stats</h3>
                    <p>Monitor server performance with live statistics and request tracking.</p>
                    <button onclick="refreshStats()" class="feature-link">Refresh Stats</button>
                </div>
            </div>
        </div>

        <div class="api-section">
            <h2>üîó API Endpoints</h2>
            <div class="api-list">
                <div class="api-item">
                    <code>GET /api/stats</code>
                    <p>Get server statistics including uptime, total requests, and server information.</p>
                    <a href="/api/stats" target="_blank">Try it ‚Üí</a>
                </div>
                <div class="api-item">
                    <code>GET /api/files</code>
                    <p>Get a JSON listing of files and directories in the root directory.</p>
                    <a href="/api/files" target="_blank">Try it ‚Üí</a>
                </div>
                <div class="api-item">
                    <code>GET /api/files/{path}</code>
                    <p>Get a JSON listing of files and directories in a specific subdirectory.</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Built with ‚ù§Ô∏è using C# and .NET</p>
        </footer>
    </div>

    <script>
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('uptime').textContent = data.uptime_formatted;
                document.getElementById('requests').textContent = data.total_requests.toLocaleString();
                document.getElementById('directory').textContent = data.root_directory.replace(/\\/g, '/');
                document.getElementById('port').textContent = data.port;
            } catch (error) {
                console.error('Failed to load stats:', error);
                document.getElementById('uptime').textContent = 'Error';
                document.getElementById('requests').textContent = 'Error';
                document.getElementById('directory').textContent = 'Error';
                document.getElementById('port').textContent = 'Error';
            }
        }

        async function loadUserInfo() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                
                if (data.authenticated && data.username) {
                    document.getElementById('username').textContent = data.username;
                    document.getElementById('userDisplay').style.display = 'block';
                    document.getElementById('logoutBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('userDisplay').style.display = 'none';
                    document.getElementById('logoutBtn').style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
                document.getElementById('userDisplay').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
            }
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/logout';
            }
        }

        function refreshStats() {
            loadStats();
        }

        // Load stats and user info on page load
        loadStats();
        loadUserInfo();

        // Auto-refresh every 5 seconds
        setInterval(loadStats, 5000);
        setInterval(loadUserInfo, 5000);
    </script>
</body>
</html>
